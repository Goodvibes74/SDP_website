{% extends "core/base.html" %}
{% load static %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'css/login_register.css' %}">
{% endblock %}

{% block title %}Authentication{% endblock %}

{% block content %}

  <div class="container py-5 px-5 bg-dark rounded-4 shadow-sm mt-4 w-75 mx-auto">
    <div class="row g-4 justify-content-center px-2">
      <div class="col-md-6">
        <div class="container" 
             style="
                    background-image: url('{% static 'images/login.jpg' %}');
                    background-size: cover; 
                    background-position: center;
                    height: 100%; 
                    border-radius: 0.5rem;
                    background-blend-mode: overlay;
                    background-color: rgba(0, 0, 0, 0.5); 
                     ">
          <div class="d-flex flex-column justify-content-center py-4 align-items-center h-100 text-white">
            <svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 49 49" fill="none">
              <rect width="48.1311" height="48.13" rx="24.065" fill="#1A71F6"/>
              <g clip-path="url(#clip0_72_750)">
                <path d="M22.0273 9.93765V9.93565C22.0527 9.83032 22.0787 9.71698 22.1707 9.65898C22.3453 9.54765 22.814 9.39832 24.0653 9.39832C25.3167 9.39832 25.7853 9.54765 25.96 9.65898C26.052 9.71698 26.078 9.83032 26.1027 9.93565V9.93765C26.168 10.2156 26.306 10.8383 26.436 11.6196C31.5307 12.5843 35.546 16.5996 36.5107 21.6936C37.0746 21.7874 37.6356 21.8986 38.1927 22.027H38.1947C38.3 22.0523 38.4133 22.0783 38.4713 22.1703C38.5827 22.3456 38.732 22.8136 38.732 24.065C38.732 25.3163 38.5827 25.785 38.4713 25.9596C38.4133 26.0516 38.3 26.0776 38.1947 26.1023H38.1927C37.6356 26.2307 37.0746 26.3419 36.5107 26.4356C35.546 31.5303 31.5307 35.5456 26.4367 36.5103C26.3429 37.0743 26.2318 37.6352 26.1033 38.1923V38.1943C26.078 38.2996 26.052 38.413 25.96 38.471C25.7847 38.5823 25.3167 38.7316 24.0653 38.7316C22.814 38.7316 22.3453 38.5823 22.1707 38.471C22.0787 38.413 22.0527 38.2996 22.028 38.1943V38.1923C21.8996 37.6352 21.7884 37.0743 21.6947 36.5103C16.6 35.5456 12.5847 31.5303 11.62 26.4363C11.056 26.3426 10.4951 26.2314 9.93802 26.103H9.93601C9.83068 26.0776 9.71735 26.0516 9.65935 25.9596C9.54802 25.785 9.39868 25.3163 9.39868 24.065C9.39868 22.8136 9.54802 22.345 9.65935 22.1703C9.71735 22.0783 9.83068 22.0523 9.93601 22.0276H9.93802C10.4951 21.8992 11.056 21.7881 11.62 21.6943C12.5847 16.5996 16.6 12.5843 21.694 11.6196C21.8247 10.8383 21.9627 10.2156 22.0273 9.93765Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M15.3987 24.065C15.3987 28.8516 19.2787 32.7316 24.0653 32.7316C28.852 32.7316 32.732 28.8516 32.732 24.065C32.732 19.2783 28.852 15.3983 24.0653 15.3983C19.2787 15.3983 15.3987 19.2783 15.3987 24.065Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M26.732 21.4456C26.732 21.4456 25.6653 20.7316 24.0653 20.7316C22.732 20.7316 21.3987 21.4456 21.3987 22.3983C21.3987 24.779 26.732 23.351 26.732 25.7316C26.732 26.6843 25.3987 27.3983 24.0653 27.3983C22.4653 27.3983 21.3987 26.6843 21.3987 26.6843" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M24.0654 20.7316V19.3983" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M24.0654 28.7316V27.3983" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </g>
              <defs>
                <clipPath id="clip0_72_750">
                  <rect width="32" height="32" fill="white" transform="translate(8.06543 8.065)"/>
                </clipPath>
              </defs>
            </svg>
            <h2 class="text-center">Welcome to Moneyworth</h2>
            <p class="text-center text-muted">Your number one SaleApp</p>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <ul class="nav nav-pills mb-3" id="authTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login-tab-pane" type="button" role="tab" aria-controls="login-tab-pane" aria-selected="true">Login</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register-tab-pane" type="button" role="tab" aria-controls="register-tab-pane" aria-selected="false">Register</button>
          </li>
        </ul>
        <div class="tab-content" id="authTabContent">
          <!-- Login Tab -->
          <div class="tab-pane fade show active" id="login-tab-pane" role="tabpanel" aria-labelledby="login-tab">
            <form method="post" action="{% url 'login' %}" class="needs-validation" novalidate>
              {% csrf_token %}
              <div class="mb-3">
                <label for="inputUsername" class="form-label">Username</label>
                <input type="text" class="form-control" id="inputUsername" name="username" placeholder="Enter your username" required>
                <div class="invalid-feedback">Please enter your username.</div>
              </div>
              <div class="mb-3">
                <label for="inputPassword" class="form-label">Password</label>
                <input type="password" class="form-control" id="inputPassword" name="password" placeholder="Enter your password" required>
                <div class="invalid-feedback">Please enter your password.</div>
              </div>
              <button type="submit" class="btn btn-primary w-100">Sign in</button>
              {% if login_error %}
                <div class="alert alert-danger mt-3">{{ login_error }}</div>
              {% endif %}
            </form>
          </div>

          <!-- Register Tab -->
          <div class="tab-pane fade" id="register-tab-pane" role="tabpanel" aria-labelledby="register-tab">
            <form method="post" action="{% url 'register' %}" class="needs-validation" novalidate>
              {% csrf_token %}
              <div class="mb-3">
                <label for="registerUsername" class="form-label">Username</label>
                <input type="text" class="form-control" id="registerUsername" name="username" placeholder="Enter your username" required>
                <div class="invalid-feedback">Please enter a username.</div>
              </div>
              <div class="mb-3">
                <label for="registerEmail" class="form-label">Email</label>
                <input type="email" class="form-control" id="registerEmail" name="email" placeholder="Enter your email" required>
                <div class="invalid-feedback">Please enter a valid email address.</div>
              </div>
              <div class="mb-3">
                <label for="registerPassword" class="form-label">Password</label>
                <input type="password" class="form-control" id="registerPassword" name="password1" placeholder="Enter your password" required>
                <div class="invalid-feedback">Please enter a password.</div>
              </div>
              <div class="mb-3">
                <label for="confirmPassword" class="form-label">Confirm Password</label>
                <input type="password" class="form-control" id="confirmPassword" name="password2" placeholder="Confirm your password" required>
                <div class="invalid-feedback">Please confirm your password.</div>
              </div>
              <button type="submit" class="btn btn-primary w-100">Register</button>
              {% if register_error %}
                <div class="alert alert-danger mt-3">{{ register_error }}</div>
              {% endif %}
            </form>
          </div>
        </div>
      </div>
  </div>

  <style>
    body.dark-mode {
      background-color: #121212;
      color: #ffffff;
    }
    .dark-mode .form-control {
      background-color: #1e1e1e;
      color: #ffffff;
      border-color: #333333;
    }
    .dark-mode .nav-link {
      color: #ffffff;
    }
    .dark-mode .nav-link.active {
      background-color: #444444;
    }
    .alert {
      margin-top: 1rem;
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.body.classList.add('dark-mode');

      // Bootstrap validation
      const forms = document.querySelectorAll('.needs-validation');
      Array.from(forms).forEach(function (form) {
        form.addEventListener('submit', function (event) {
          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    });
  </script>
{% endblock %}